function o(s){let e=u(s);document.getElementById("main_container").prepend(e),e.scrollIntoView({behavior:"smooth"})}function u(s){let e=document.createElement("span");e.innerText=s;let t=document.createElement("div");return t.classList.add("alert","alert-danger","alert-dismissible"),t.setAttribute("role","alert"),t.appendChild(e),t.appendChild(h()),t}function h(){let s=document.createElement("button");s.classList.add("btn-close"),s.dataset.bsDismiss="alert";let e=document.createElement("span");return e.classList.add("sr-only"),e.innerText="Close",s.appendChild(e),s}function l(s){let e=document.getElementById(s);e!==null&&e.classList.add("d-none")}function c(s){let e=document.getElementById(s);e!==null&&e.classList.remove("d-none")}var d=class{_table=null;tableId=void 0;filesPath=void 0;breadcrumbId=void 0;initialDirectory=void 0;selectButtonId=void 0;inputFieldId=void 0;modalId=void 0;showHidden=void 0;showFiles=void 0;filePattern=void 0;constructor(e){this.tableId=e.tableId,this.filesPath=e.filesPath,this.breadcrumbId=e.breadcrumbId,this.initialDirectory=e.initialDirectory,this.selectButtonId=e.selectButtonId,this.inputFieldId=e.inputFieldId,this.modalId=e.modalId,this.showHidden=e.showHidden==="true",this.showFiles=e.showFiles==="true",this.filePattern=e.filePattern,this.initDataTable(),this.reloadTable(this.initialUrl()),$(`#${this.tableId} tbody`).on("click","tr",t=>{this.clickRow(t)}),$("#favorites").on("click","li",t=>{this.clickRow(t)}),$(`#${this.breadcrumbId}`).on("click","li",t=>{this.clickBreadcrumb(t)}),$(`#${this.selectButtonId}`).on("click",t=>{this.selectPath(t)})}initDataTable(){this._table=$(`#${this.tableId}`).DataTable({autoWidth:!1,language:{search:"Filter:"},order:[[0,"asc"],[1,"asc"]],rowId:"id",paging:!1,scrollCollapse:!0,select:{style:"os",className:"selected",toggleable:!0,selector:"td:not(:first-child)"},dom:"<'row'<'col-sm-12'f>><'row'<'col-sm-12'<'dt-status-bar'<'datatables-status float-end'><'transfers-status'>>>><'row'<'col-sm-12'tr>>",columns:[{data:"type",render:(e,t,n,a)=>e=="d"?'<span title="directory" class="fa fa-folder gold"><span class="sr-only">directory</span></span>':'<span title="file" class="fa fa-file black"><span class="sr-only">file</span></span>'},{name:"name",data:"name",className:"text-break",render:(e,t,n,a)=>{let r=document.createElement("span");return r.textContent=e,r.outerHTML}}],createdRow:function(e,t,n){e.classList.add("clickable"),e.dataset.apiUrl=t.url,e.dataset.pathType=t.type}})}async reloadTable(e){try{$(this.tableWrapper()).hide(),c(`${this.tableId}_spinner`);let t=await fetch(e,{headers:{Accept:"application/json"},cache:"no-store"}),n=await this.dataFromJsonResponse(t);$(`#${this.breadcrumbId}`).html(n.path_selector_breadcrumbs_html),this._table.clear(),this._table.rows.add(n.files),this.setLastVisited(n.path),this._table.draw(),this.resetTable()}catch(t){this.resetTable(),t.message.match("Permission denied")&&($("#forbidden-warning").removeClass("d-none"),$("#forbidden-warning").trigger("focus")),console.log(t)}}resetTable(){l(`${this.tableId}_spinner`),$(this.tableWrapper()).show(),$("#forbidden-warning").addClass("d-none")}dataFromJsonResponse(e){return new Promise((t,n)=>{Promise.resolve(e).then(a=>a.ok?Promise.resolve(a):Promise.reject(new Error(a.statusText))).then(a=>a.json()).then(a=>this.filterFileResponse(a)).then(a=>a.error_message?Promise.reject(new Error(a.error_message)):t(a)).catch(a=>n(a))})}clickRow(e){let t=$(e.target).closest("tr").get(0)||e.target,n=t.dataset.apiUrl,a=t.dataset.pathType;if(this.activateFavorite(t),a=="f"){let r=n.replace(this.filesPath,"").replaceAll("//","/");this.setLastVisited(r,a)}else this.reloadTable(n)}activateFavorite(e){$("li.active").each((t,n)=>{n.classList.remove("active")}),e.tagName=="LI"&&e.classList.add("active")}clickBreadcrumb(e){let t=e.target.id;this.activateFavorite(e.target),this.reloadTable(t)}selectPath(e){let t=this.getLastVisited(),n=document.getElementById(this.inputFieldId);n.value=t.path,$(`#${this.modalId}`).modal("hide")}storageKey(){let e=window.location.pathname.replaceAll("/","_");return`${this.tableId}${e}_last_visited`}tableWrapper(){return`#${this.tableId}_wrapper`}getLastVisited(){let e=localStorage.getItem(this.storageKey());return e===null?{path:this.initialDirectory,type:"d"}:JSON.parse(e)}setLastVisited(e,t="d"){let n={path:decodeURI(e),type:t};e&&localStorage.setItem(this.storageKey(),JSON.stringify(n))}initialUrl(){let e=this.getLastVisited(),t;return e.type=="f"?t=e.path.split("/").slice(0,-1).join("/"):t=e.path,t.startsWith("/")?`${this.filesPath}${t}`:`${this.filesPath}/${t}`}filterFileResponse(e){let t;try{this.filePattern!==void 0&&(t=RegExp(this.filePattern))}catch{o("The regular expression provided for this path selector did not compile")}let n=e.files.filter(a=>{let r=a.name.startsWith("."),i=a.type=="f";return r&&i?this.showHidden&&this.showFiles:r?this.showHidden:i?this.filteredByFilename(a,t):!0});return e.files=n,e}filteredByFilename(e,t){return t!==void 0?e.name.match(t)?this.showFiles:!1:this.showFiles}};export{d as PathSelectorTable};
//# sourceMappingURL=/pun/sys/dashboard/assets/path_selector/path_selector_data_table.js-6851f96e44ea73bb08e0d4682c9dac1ad92dc82bbafcf15c44a9e4e2a5c582be.map
//!
;
