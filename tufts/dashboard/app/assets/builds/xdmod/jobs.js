var h="ood_config";function b(){return document.getElementById(h).dataset}function f(t){return`${b().baseAnalyticsPath}/${t}`}function p(t,n){let e=new URL(f(t),document.location);e.searchParams.append("error",n),fetch(e)}function B(t,n){let e=document.createElement("div");return e.classList.add("xdmod"),e.append(y(t,n)),e}function y(t,n){let e=document.createElement("div");return e.classList.add("card","mt-3"),e.append(x(n)),e.append(D(t,n)),e}function x(t){let n=document.createElement("div");return n.classList.add("card-header"),n.innerHTML=`<a href="${t.xdmod_url()}" class="float-end">Open XDMoD <span class="fa fa-external-link-square-alt"></span></a>
                   <h3>${t.title()} - ${t.date_range()}</h3>`,n}function D(t,n){return t.error!==void 0?g(t.error,n):t.loading!==void 0?L():E(t,n)}function g(t,n){let e=u(),a=`<div class="alert alert-danger mb-0">
                      ${t} Please ensure you are <a href="${n.xdmod_url()}">logged into Open XDMoD first</a>, and then try again.
                    </div>`;return e.innerHTML=a,e}function L(){let t=u();return t.innerHTML='<p class="card-text">LOADING...</p>',t}function E(t,n){let e=u();return e.append(w(t,n)),e}function u(){let t=document.createElement("div");return t.classList.add("card-body"),t}function w(t,n){let e=document.createElement("div");e.classList.add("table-responsive");let a=document.createElement("table");a.classList.add("table","table-sm","table-striped","table-condensed");let r=document.createElement("thead");r.innerHTML='<tr>                       <th class="sr-only">Analytics Toggle</th>                       <th class="id">ID</th>                       <th class="name">Name</th>                       <th class="date">Date</th>                       <th class="sr-only">Analytics</th>                     </tr>';let o=document.createElement("tbody");return o.append(...v(t,n)),a.append(r),a.append(o),e.append(a),e}function v(t,n){let e=t.results;if(e===void 0||e.length==0)return[A()];let a=[];return e.forEach(r=>{let o=document.createElement("tr");o.title=`${r.job_name} - ${r.local_job_id}`,o.setAttribute("data-xdmod-jobid",r.jobid),o.setAttribute("data-bs-toggle","collapse"),o.setAttribute("data-bs-target",`#details_${r.jobid}`),o.setAttribute("aria-expanded","false");let d=document.createElement("td");d.innerHTML=`
      <button class="btn btn-default btn-xs">
        <i class="fa fa-plus fa-fw app-icon closed" aria-hidden="true"></i>
        <i class="fa fa-minus fa-fw app-icon open" aria-hidden="true"></i>
      </button>`;let l=document.createElement("td");l.classList.add("text-nowrap"),l.append(P(n.job_url(r.jobid),r.local_job_id));let c=document.createElement("td");c.classList.add("overflow-hidden","text-truncate","mw-150px"),c.innerText=r.job_name;let i=document.createElement("td");i.innerText=n.date(r);let s=document.createElement("td");s.id=`details_${r.jobid}`,s.classList.add("job-analytics","collapse"),s.innerHTML='<div class="job-analytics-content"><span>LOADING...</span></div>',s.addEventListener("shown.bs.collapse",function(I){T(r,n)},{once:!0}),o.append(d,l,c,i,s),a.push(o)}),a}function P(t,n){let e=document.createElement("a");return e.href=t,e.innerHTML=`${n} ${_()}`,e}function _(){return'<span class="fa fa-external-link-square-alt"></span>'}function A(){let t=document.createElement("td");t.setAttribute("colspan","7"),t.innerHTML="No data available.";let n=document.createElement("tr");return n.append(t),n}function m(t,n,e,a){if(t.error!==void 0){let i=g(t.error,a),s=document.getElementById(e);s.closest("tr").classList.add("error"),s.replaceChildren(i);return}let r=t.data.reduce((i,s)=>(i[s.key]=s,i),{}),o=r["CPU User"]?.value||n.cpu_user,d=r["Memory Headroom"]?.value,l=r["Walltime Accuracy"]?.value||n.walltime_accuracy,c=document.createElement("div");c.classList.add("job-analytics-content"),c.innerHTML=`<span><strong>CPU:</strong> ${a.efficiency_label(o,!1)}</span>
                   <span><strong>Mem:</strong> ${a.efficiency_label(d,!0)}</span>
                   <span><strong>Walltime:</strong> ${a.efficiency_label(l,!1)}</span>`,document.getElementById(e).replaceChildren(c)}function M(t,n){let e=new URL(`${n.xdmod_url()}/rest/v1.0/warehouse/search/jobs/analytics`);return e.searchParams.set("_dc",Date.now()),e.searchParams.set("realm",n.realm),e.searchParams.set("jobid",t),e}function T(t,n){let e=`details_${t.jobid}`;fetch(M(t.jobid,n),{credentials:"include"}).then(a=>a.ok?Promise.resolve(a):Promise.reject(new Error(a.statusText))).then(a=>a.json()).then(a=>m(a,t,e,n)).catch(a=>{console.error(a),m({error:a},t,e,n),p("xdmod_jobs_analytics_widget_error",a)})}export{B as jobsPanel};
//# sourceMappingURL=jobs.js.map
