function T(t){let e=ne(t);document.getElementById("main_container").prepend(e),e.scrollIntoView({behavior:"smooth"})}function ne(t){let e=document.createElement("span");e.innerText=t;let n=document.createElement("div");return n.classList.add("alert","alert-danger","alert-dismissible"),n.setAttribute("role","alert"),n.appendChild(e),n.appendChild(se()),n}function se(){let t=document.createElement("button");t.classList.add("btn-close"),t.dataset.bsDismiss="alert";let e=document.createElement("span");return e.classList.add("sr-only"),e.innerText="Close",t.appendChild(e),t}var ie="ood_config";function ae(){return document.getElementById(ie).dataset}function C(){return ae().bcDynamicJs=="true"}function H(t){let e=document.getElementById(t);e!==null&&e.classList.add("d-none")}function W(t){let e=document.getElementById(t);e!==null&&e.classList.remove("d-none")}var b=class{_table=null;tableId=void 0;filesPath=void 0;breadcrumbId=void 0;initialDirectory=void 0;selectButtonId=void 0;inputFieldId=void 0;modalId=void 0;showHidden=void 0;showFiles=void 0;filePattern=void 0;constructor(e){this.tableId=e.tableId,this.filesPath=e.filesPath,this.breadcrumbId=e.breadcrumbId,this.initialDirectory=e.initialDirectory,this.selectButtonId=e.selectButtonId,this.inputFieldId=e.inputFieldId,this.modalId=e.modalId,this.showHidden=e.showHidden==="true",this.showFiles=e.showFiles==="true",this.filePattern=e.filePattern,this.initDataTable(),this.reloadTable(this.initialUrl()),$(`#${this.tableId} tbody`).on("click","tr",n=>{this.clickRow(n)}),$("#favorites").on("click","li",n=>{this.clickRow(n)}),$(`#${this.breadcrumbId}`).on("click","li",n=>{this.clickBreadcrumb(n)}),$(`#${this.selectButtonId}`).on("click",n=>{this.selectPath(n)})}initDataTable(){this._table=$(`#${this.tableId}`).DataTable({autoWidth:!1,language:{search:"Filter:"},order:[[0,"asc"],[1,"asc"]],rowId:"id",paging:!1,scrollCollapse:!0,select:{style:"os",className:"selected",toggleable:!0,selector:"td:not(:first-child)"},dom:"<'row'<'col-sm-12'f>><'row'<'col-sm-12'<'dt-status-bar'<'datatables-status float-end'><'transfers-status'>>>><'row'<'col-sm-12'tr>>",columns:[{data:"type",render:(e,n,a,s)=>e=="d"?'<span title="directory" class="fa fa-folder gold"><span class="sr-only">directory</span></span>':'<span title="file" class="fa fa-file black"><span class="sr-only">file</span></span>'},{name:"name",data:"name",className:"text-break",render:(e,n,a,s)=>{let i=document.createElement("span");return i.textContent=e,i.outerHTML}}],createdRow:function(e,n,a){e.classList.add("clickable"),e.dataset.apiUrl=n.url,e.dataset.pathType=n.type}})}async reloadTable(e){try{$(this.tableWrapper()).hide(),W(`${this.tableId}_spinner`);let n=await fetch(e,{headers:{Accept:"application/json"},cache:"no-store"}),a=await this.dataFromJsonResponse(n);$(`#${this.breadcrumbId}`).html(a.path_selector_breadcrumbs_html),this._table.clear(),this._table.rows.add(a.files),this.setLastVisited(a.path),this._table.draw(),this.resetTable()}catch(n){this.resetTable(),n.message.match("Permission denied")&&($("#forbidden-warning").removeClass("d-none"),$("#forbidden-warning").trigger("focus")),console.log(n)}}resetTable(){H(`${this.tableId}_spinner`),$(this.tableWrapper()).show(),$("#forbidden-warning").addClass("d-none")}dataFromJsonResponse(e){return new Promise((n,a)=>{Promise.resolve(e).then(s=>s.ok?Promise.resolve(s):Promise.reject(new Error(s.statusText))).then(s=>s.json()).then(s=>this.filterFileResponse(s)).then(s=>s.error_message?Promise.reject(new Error(s.error_message)):n(s)).catch(s=>a(s))})}clickRow(e){let n=$(e.target).closest("tr").get(0)||e.target,a=n.dataset.apiUrl,s=n.dataset.pathType;if(this.activateFavorite(n),s=="f"){let i=a.replace(this.filesPath,"").replaceAll("//","/");this.setLastVisited(i,s)}else this.reloadTable(a)}activateFavorite(e){$("li.active").each((n,a)=>{a.classList.remove("active")}),e.tagName=="LI"&&e.classList.add("active")}clickBreadcrumb(e){let n=e.target.id;this.activateFavorite(e.target),this.reloadTable(n)}selectPath(e){let n=this.getLastVisited(),a=document.getElementById(this.inputFieldId);a.value=n.path,$(`#${this.modalId}`).modal("hide")}storageKey(){let e=window.location.pathname.replaceAll("/","_");return`${this.tableId}${e}_last_visited`}tableWrapper(){return`#${this.tableId}_wrapper`}getLastVisited(){let e=localStorage.getItem(this.storageKey());return e===null?{path:this.initialDirectory,type:"d"}:JSON.parse(e)}setLastVisited(e,n="d"){let a={path:decodeURI(e),type:n};e&&localStorage.setItem(this.storageKey(),JSON.stringify(a))}initialUrl(){let e=this.getLastVisited(),n;return e.type=="f"?n=e.path.split("/").slice(0,-1).join("/"):n=e.path,n.startsWith("/")?`${this.filesPath}${n}`:`${this.filesPath}/${n}`}filterFileResponse(e){let n;try{this.filePattern!==void 0&&(n=RegExp(this.filePattern))}catch{T("The regular expression provided for this path selector did not compile")}let a=e.files.filter(s=>{let i=s.name.startsWith("."),r=s.type=="f";return i&&r?this.showHidden&&this.showFiles:i?this.showHidden:r?this.filteredByFilename(s,n):!0});return e.files=a,e}filteredByFilename(e,n){return n!==void 0?e.name.match(n)?this.showFiles:!1:this.showFiles}};function B(){$("[data-path-selector='true']").each((t,e)=>{let n=`#${re(e.id)}`,a=$(n).get(0);oe(a)})}function re(t){return`${t}_path_selector`}function oe(t){let e=le(t);new b(e)}function le(t){let e={};return e.filesPath=t.dataset.filesPath,e.initialDirectory=t.dataset.initialDirectory,e.tableId=t.dataset.tableId,e.breadcrumbId=t.dataset.breadcrumbId,e.selectButtonId=t.dataset.selectButtonId,e.inputFieldId=t.dataset.inputFieldId,e.showFiles=t.dataset.showFiles,e.showHidden=t.dataset.showHidden,e.filePattern=t.dataset.filePattern,e.modalId=t.id,e}var M="batch_connect_session_context",A="batch_connect_session_prefill_template";function N(){let t=$(`#${A}`);t.length!=0&&t.on("change",function(){let e=$(`#${A} option:selected`);if(!e.val())return;let n;try{n=JSON.parse(e.val())}catch(s){$("#batch_connect_session_template_form_error_modal").text(s.message),$("#batch_connect_session_template_form_error_modal_body").modal("show");return}let a="";for(let[s,i]of Object.entries(n)){let r=$(`#${M}_${s}`);if(r.length==0)if(/^\d+$/.test(i))r=$(`#${M}_${s}_${i}`);else continue;if(r.is("select")&&i!==""&&r.find(`option[value="${i}"]`).length==0){a+=`Invalid value: "${i}" for the field "${s}".<br>`;continue}switch(r.attr("type")){case"checkbox":i==="1"?r.prop("checked",!0):r.prop("checked",!1);break;case"radio":r.filter(`[value="${i}"]`).prop("checked",!0);default:r.val(i);break}r.trigger("change")}a&&($("#batch_connect_session_template_form_error_modal_body").html(a),$("#batch_connect_session_template_form_error_modal").modal("show"))})}var F="modal_input_template_name",k="modal_input_template_new_name";function j(){let t=$("#chooseTemplateName");if(t.length===0)return;let e=$("#batch_connect_session_template_name_error_modal"),n=$("#batch_connect_session_template_name"),a=$("#batch_connect_session_save_template"),s=$("#batch_connect_session_save_template_submit");$(`#${F}`).on("change",function(){let i=$(`#${k}`);$(this).val()===""?i.show():i.hide()}),$("#batch_connect_session_template_choose_name_button").on("click",function(){let i=$(`#${F}`).val()||$(`#${k}`).val();if(i===""){e.modal("show");return}e.modal("hide"),n.val(i),t.modal("hide"),s.prop("disabled",!1)}),a.on("change",function(){if($(this).is(":checked"))t.modal("show");else{n.val(""),$(`#${F}`).val("");let i=$(`#${k}`);i.val(""),i.show(),s.prop("disabled",!0)}}),t.on("hidden.bs.modal",function(){n.val()===""&&(a.prop("checked",!1),a.trigger("change"))})}var w=void 0,Y=void 0,O=[],D={},L={},_=[],V=[],x={},I={},g={},v={},y={},E={},ce=/[-_]([a-z])|([_-][0-9])|([\/])/g,G=!0;function de(t){return`${w}_${t.toLowerCase()}`}function ue(t){let e=t.match(Y);return e.length>=1?e[1]:""}function Z(t){let e=t.toLowerCase(),n=e.charAt(0).toUpperCase(),a=e.slice(1).replace(ce,function(s,i,r,o){if(i)return i.toUpperCase();if(r)return r.replace("_","-");if(o)return"_"});return`${n}${a}`}function f(t){if(t===void 0)return;let e=/([A-Z]{1}[a-z]*[0-9]*)|([^-_]+)/g;return t.match(e).filter(a=>a!="").map(a=>a.toLowerCase()).join("_")}function fe(t){t.each((e,n)=>{O.push(Z(ue(n.id)))})}function Q(t){w=t,Y=new RegExp(`${w}_([\\w\\-]+)`);let e=$(`[id^=${w}]`);fe(e),e.each((n,a)=>{if(a.type=="select-one"){let s=`#${a.id} option`;$(s).each((r,o)=>{let c=$(`${s}[value='${o.value}']`).data(),d=Object.keys(c);d.length!==0&&d.forEach(l=>{if(l.startsWith("optionFor")){let u=l.replace(/^optionFor/,"");xe(h(u),a.id)}else if(l.startsWith("exclusiveOptionFor")){let u=l.replace(/^exclusiveOptionFor/,"");we(h(u),a.id)}else l.startsWith("max")||l.startsWith("min")?me(a.id,o.value,l,c[l]):l.startsWith("set")?ge(a.id,o.value,l,c[l]):l.startsWith("hide")?R(a.id,o.value,l,c[l]):l.startsWith("label")&&pe(a.id,o.value,l,c[l])})})}else if(a.type=="checkbox"){let s=$(a).data(),i=Object.keys(s);i.length!==0&&i.forEach(r=>{if(r.startsWith("hide")){let o=ve(r);o!==void 0&&R(a.id,o.value,o.key,s[r])}})}}),G=!1}function R(t,e,n,a){let s=h(n.replace(/^hide/,""));y[t]===void 0&&(y[t]=new p(s,void 0)),y[t].put(s,e,a),x[t]===void 0&&(x[t]=[]),x[t].includes(s)||($(`#${t}`).on("change",o=>{J(o,s)}),x[t].push(s)),J({target:document.querySelector(`#${t}`)},s)}function he(t,e){let n=t[0].selectedIndex;return t[0].options[n].dataset[e]}function U(t,e,n){$(`label[for="${t}"]`)[0].innerHTML=he(e,n)}function pe(t,e,n,a){let s=h(n.replace(/^label/,"")),i=$(`#${t}`);E[t]===void 0&&(E[t]=new p(s,void 0)),E[t].put(s,e,a),I[t]===void 0&&(I[t]=[]),I[t].includes(s)||i.on("change",o=>{U(s,i,n)}),U(s,i,n)}function me(t,e,n,a){t=String(t||""),a=parseInt(a);let s=ye(n),i=s.subjectId;if(i===void 0)return;let r=s.predicateId,o=s.predicateValue,c=`${t}_${i}`;g[c]===void 0&&(g[c]=new p(t,r)),g[c].put(e,o,{[Fe(n)]:a});let l=`${i}_${t}_${r}`;_.includes(l)||($(`#${t}`).on("change",m=>{P(m,i,r)}),_.push(l)),l=`${i}_${r}_${t}`,r!==void 0&&!_.includes(l)&&($(`#${r}`).on("change",m=>{P(m,i,t)}),_.push(l)),P({target:document.querySelector(`#${t}`)},i,r)}function ge(t,e,n,a){let s=n.replace(/^set/,""),i=String(h(s));if(i==="undefined")return;let r=`${i}_${t}`;v[r]===void 0&&(v[r]=new p(t,void 0)),v[r].put(e,void 0,a),V.includes(r)||($(`#${t}`).on("change",d=>{q(d,i)}),V.push(r)),q({target:document.querySelector(`#${t}`)},i)}function q(t,e){let n=t.target.value,a=`${e}_${t.target.id}`,s=v[a];if(s===void 0)return;let i=s.get(n,void 0);if(i!==void 0){let r=document.getElementById(e);r.type=="checkbox"?be(r,i):r.value=i}}function be(t,e){let n=t.value;e==n?t.checked=!0:t.checked=!1}var p=class{constructor(e,n){this.x=e,this.xIdxLookup={},this.y=n,this.yIdxLookup={},this.table=n===void 0?[]:[[]]}put(e,n,a){if(!e)return;e=f(e),n=f(n),this.xIdxLookup[e]===void 0&&(this.xIdxLookup[e]=Object.keys(this.xIdxLookup).length),n&&this.yIdxLookup[n]===void 0&&(this.yIdxLookup[n]=Object.keys(this.yIdxLookup).length);let s=this.xIdxLookup[e],i=this.yIdxLookup[n];if(this.table[s]===void 0&&(this.table[s]=n===void 0?void 0:[]),i===void 0)if(this.table[s]===void 0)this.table[s]=a;else{let r=this.table[s],o=a;typeof o=="string"&&typeof r=="string"?this.table[s]=o:this.table[s]=Object.assign(r,o)}else if(this.table[s][i]===void 0)this.table[s][i]=a;else{let r=this.table[s][i],o=a;typeof o=="string"&&typeof r=="string"?this.table[s][i]=o:this.table[s][i]=Object.assign(r,o)}}get(e,n){let a=this.xIdxLookup[f(e)],s=this.yIdxLookup[f(n)];if(this.table[a]!==void 0)return n===void 0?this.table[a]:this.table[a][s]}};function J(t,e){let n=$e(t),a=t.target.id,s;if($(`#${e}`).parents().each(function(r,o){var c=o.classList.values();for(let d of c)d.match("mb-3")&&(s=$(o))}),s===void 0||s.length<=0)return;let i=y[a].get(e,n);i===!1||i===void 0&&!G?s.show():i===!0&&s.hide()}function $e(t){return t.target.type=="checkbox"?t.target.checked?"checked":"unchecked":t.target.value}function P(t,e,n){let a,s,i=`${t.target.id}_${e}`;g[i]===void 0&&(i=`${n}_${e}`);let r=g[i];t.target.id==r.x?(a=f(t.target.value),s=f($(`#${n}`).val())):(s=f(t.target.value),a=f($(`#${n}`).val()));let o=$(`#${e}`),c=r.get(a,s),d={min:parseInt(o.attr("min")),max:parseInt(o.attr("max"))};["max","min"].forEach(u=>{c&&c[u]!==void 0&&o.attr(u,c[u])});let l=_e(parseInt(o.val()),d,c);l!==void 0&&(o.attr("value",l),o.val(l))}function _e(t,e,n){if(n!==void 0)return t===e.min?n.min:t===e.max?n.max:t<=n.min?n.min:t>=n.max?n.max:void 0}function X(t,e,n){let a=String(t||""),s=null;if(n=="optionFor"?(D[t]==null&&(D[t]=[]),s=D):n=="exclusiveOptionFor"&&(L[t]==null&&(L[t]=[]),s=L),a.length==0||s[t].includes(e))return;let i=$(`#${t}`);e&&i&&(s[t].push(e),i.on("change",r=>{n=="exclusiveOptionFor"?K(r,e):n=="optionFor"&&z(r,e)}),n=="exclusiveOptionFor"?K({target:document.querySelector(`#${t}`)},e):n=="optionFor"&&z({target:document.querySelector(`#${t}`)},e))}function xe(t,e){X(t,e,"optionFor")}function we(t,e){X(t,e,"exclusiveOptionFor")}function ve(t){let e=t.match(/^hide(\w+)When(\w+)$/);if(e!==void 0&&e.length&&e.length==3)return{key:e[1],value:e[2].toLowerCase()=="checked"?"checked":"unchecked"}}function ye(t){let e,n,a,s;t.startsWith("min")?e=t.replace(/^min/,""):t.startsWith("max")&&(e=t.replace(/^max/,""));let i=e.match(/^(\w+)For(\w+)$/);if(i==null)s=h(e);else if(i.length==3){let r=i[1],o=i[2];s=h(r);let c=o.split(/(?=[A-Z])/);if(c&&c.length>=2)if(c.length==2)n=h(c[0]),a=c[1];else{let d="",l=!1;c.forEach((u,m)=>{if(l)return;d=`${d}${u}`;let S=h(d);S!==void 0&&(l=!0,n=S,a=c.slice(m+1).join(""))})}}return{subjectId:s,predicateId:n,predicateValue:f(a)}}function Fe(t){return t.startsWith("min")?"min":t.startsWith("max")?"max":null}function h(t){if(elements=O.map(e=>{let n=t.match(`^${e}{1}`);if(n&&n.length>=1){let a=f(n[0]);return de(a)}}).filter(e=>e!==void 0),elements.length!=0){if(elements.length==1)return elements[0];if(elements.length>1){let e=f(t);return elements.filter(n=>n.endsWith(e))[0]}}}function ee(t,e){return O.map(n=>{let a=t.match(`^${e}${n}`);if(a&&a.length>=1)return n}).filter(n=>n!==void 0)[0]}function ke(t){return ee(t,"optionFor")}function De(t){return ee(t,"exclusiveOptionFor")}function te(t,e,n){let a=[...document.querySelectorAll(`#${e} option`)],s;if(a.forEach(i=>{let r=!1;for(let o of Object.keys(i.dataset)){let c="";n=="optionFor"?c=ke(o):n=="exclusiveOptionFor"&&(c=De(o));let d=h(o.replace(new RegExp(`^${n}`),""));if(!o.startsWith(n)||d===void 0)continue;let l=Z(document.getElementById(d).value);if(l.match(/^\d/)&&(l=`-${l}`),n=="optionFor"?r=i.dataset[`optionFor${c}${l}`]==="false":n=="exclusiveOptionFor"&&(r=i.dataset[`exclusiveOptionFor${c}${l}`]!=="true"),r)break}r?(i.selected&&(i.selected=!1,s=i.textContent),i.style.display="none",i.disabled=!0):(i.style.display="",i.disabled=!1)}),s!==void 0){let i=[...document.querySelectorAll(`#${e} option[value='${s}']`)],r;i.length>1&&i.forEach(o=>{if(o.style.display===""){r=o;return}}),r===void 0&&(i=document.querySelectorAll(`#${e} option`),i.forEach(o=>{r===void 0&&o.style.display===""&&(r=o)})),r!==void 0&&(r.selected=!0)}document.getElementById(e).dispatchEvent(new Event("change",{bubbles:!0}))}function z(t,e){te(t,e,"optionFor")}function K(t,e){te(t,e,"exclusiveOptionFor")}jQuery(function(){C()&&Q("batch_connect_session_context"),B(),N(),j()});
//# sourceMappingURL=batch_connect_session_contexts.js.map
