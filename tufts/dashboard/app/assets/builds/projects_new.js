function l(a){let t=h(a);document.getElementById("main_container").prepend(t),t.scrollIntoView({behavior:"smooth"})}function h(a){let t=document.createElement("span");t.innerText=a;let e=document.createElement("div");return e.classList.add("alert","alert-danger","alert-dismissible"),e.setAttribute("role","alert"),e.appendChild(t),e.appendChild(p()),e}function p(){let a=document.createElement("button");a.classList.add("btn-close"),a.dataset.bsDismiss="alert";let t=document.createElement("span");return t.classList.add("sr-only"),t.innerText="Close",a.appendChild(t),a}function c(a){let t=document.getElementById(a);t!==null&&t.classList.add("d-none")}function d(a){let t=document.getElementById(a);t!==null&&t.classList.remove("d-none")}var i=class{_table=null;tableId=void 0;filesPath=void 0;breadcrumbId=void 0;initialDirectory=void 0;selectButtonId=void 0;inputFieldId=void 0;modalId=void 0;showHidden=void 0;showFiles=void 0;filePattern=void 0;constructor(t){this.tableId=t.tableId,this.filesPath=t.filesPath,this.breadcrumbId=t.breadcrumbId,this.initialDirectory=t.initialDirectory,this.selectButtonId=t.selectButtonId,this.inputFieldId=t.inputFieldId,this.modalId=t.modalId,this.showHidden=t.showHidden==="true",this.showFiles=t.showFiles==="true",this.filePattern=t.filePattern,this.initDataTable(),this.reloadTable(this.initialUrl()),$(`#${this.tableId} tbody`).on("click","tr",e=>{this.clickRow(e)}),$("#favorites").on("click","li",e=>{this.clickRow(e)}),$(`#${this.breadcrumbId}`).on("click","li",e=>{this.clickBreadcrumb(e)}),$(`#${this.selectButtonId}`).on("click",e=>{this.selectPath(e)})}initDataTable(){this._table=$(`#${this.tableId}`).DataTable({autoWidth:!1,language:{search:"Filter:"},order:[[0,"asc"],[1,"asc"]],rowId:"id",paging:!1,scrollCollapse:!0,select:{style:"os",className:"selected",toggleable:!0,selector:"td:not(:first-child)"},dom:"<'row'<'col-sm-12'f>><'row'<'col-sm-12'<'dt-status-bar'<'datatables-status float-end'><'transfers-status'>>>><'row'<'col-sm-12'tr>>",columns:[{data:"type",render:(t,e,s,n)=>t=="d"?'<span title="directory" class="fa fa-folder gold"><span class="sr-only">directory</span></span>':'<span title="file" class="fa fa-file black"><span class="sr-only">file</span></span>'},{name:"name",data:"name",className:"text-break",render:(t,e,s,n)=>{let r=document.createElement("span");return r.textContent=t,r.outerHTML}}],createdRow:function(t,e,s){t.classList.add("clickable"),t.dataset.apiUrl=e.url,t.dataset.pathType=e.type}})}async reloadTable(t){try{$(this.tableWrapper()).hide(),d(`${this.tableId}_spinner`);let e=await fetch(t,{headers:{Accept:"application/json"},cache:"no-store"}),s=await this.dataFromJsonResponse(e);$(`#${this.breadcrumbId}`).html(s.path_selector_breadcrumbs_html),this._table.clear(),this._table.rows.add(s.files),this.setLastVisited(s.path),this._table.draw(),this.resetTable()}catch(e){this.resetTable(),e.message.match("Permission denied")&&($("#forbidden-warning").removeClass("d-none"),$("#forbidden-warning").trigger("focus")),console.log(e)}}resetTable(){c(`${this.tableId}_spinner`),$(this.tableWrapper()).show(),$("#forbidden-warning").addClass("d-none")}dataFromJsonResponse(t){return new Promise((e,s)=>{Promise.resolve(t).then(n=>n.ok?Promise.resolve(n):Promise.reject(new Error(n.statusText))).then(n=>n.json()).then(n=>this.filterFileResponse(n)).then(n=>n.error_message?Promise.reject(new Error(n.error_message)):e(n)).catch(n=>s(n))})}clickRow(t){let e=$(t.target).closest("tr").get(0)||t.target,s=e.dataset.apiUrl,n=e.dataset.pathType;if(this.activateFavorite(e),n=="f"){let r=s.replace(this.filesPath,"").replaceAll("//","/");this.setLastVisited(r,n)}else this.reloadTable(s)}activateFavorite(t){$("li.active").each((e,s)=>{s.classList.remove("active")}),t.tagName=="LI"&&t.classList.add("active")}clickBreadcrumb(t){let e=t.target.id;this.activateFavorite(t.target),this.reloadTable(e)}selectPath(t){let e=this.getLastVisited(),s=document.getElementById(this.inputFieldId);s.value=e.path,$(`#${this.modalId}`).modal("hide")}storageKey(){let t=window.location.pathname.replaceAll("/","_");return`${this.tableId}${t}_last_visited`}tableWrapper(){return`#${this.tableId}_wrapper`}getLastVisited(){let t=localStorage.getItem(this.storageKey());return t===null?{path:this.initialDirectory,type:"d"}:JSON.parse(t)}setLastVisited(t,e="d"){let s={path:decodeURI(t),type:e};t&&localStorage.setItem(this.storageKey(),JSON.stringify(s))}initialUrl(){let t=this.getLastVisited(),e;return t.type=="f"?e=t.path.split("/").slice(0,-1).join("/"):e=t.path,e.startsWith("/")?`${this.filesPath}${e}`:`${this.filesPath}/${e}`}filterFileResponse(t){let e;try{this.filePattern!==void 0&&(e=RegExp(this.filePattern))}catch{l("The regular expression provided for this path selector did not compile")}let s=t.files.filter(n=>{let r=n.name.startsWith("."),o=n.type=="f";return r&&o?this.showHidden&&this.showFiles:r?this.showHidden:o?this.filteredByFilename(n,e):!0});return t.files=s,t}filteredByFilename(t,e){return e!==void 0?t.name.match(e)?this.showFiles:!1:this.showFiles}};function u(){$("[data-path-selector='true']").each((a,t)=>{let e=`#${f(t.id)}`,s=$(e).get(0);m(s)})}function f(a){return`${a}_path_selector`}function m(a){let t=g(a);new i(t)}function g(a){let t={};return t.filesPath=a.dataset.filesPath,t.initialDirectory=a.dataset.initialDirectory,t.tableId=a.dataset.tableId,t.breadcrumbId=a.dataset.breadcrumbId,t.selectButtonId=a.dataset.selectButtonId,t.inputFieldId=a.dataset.inputFieldId,t.showFiles=a.dataset.showFiles,t.showHidden=a.dataset.showHidden,t.filePattern=a.dataset.filePattern,t.modalId=a.id,t}jQuery(function(){$("#project_template").on("change",a=>b(a)),u()});function b(a){let t=$(`#project_template option[value="${a.target.value}"]`)[0];if(t===void 0)return;let e=t.label,s=t.dataset.description,n=t.dataset.icon;$("#project_name").val(e),$("#project_description").val(s),$("#product_icon_select").val(n),$("#product_icon_select").trigger("change")}
//# sourceMappingURL=projects_new.js.map
